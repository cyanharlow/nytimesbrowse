"use strict";var categoriesData,overviewData,categoryData,bookData,templateContent,numImgsLoaded=0,totalImagesNeeded=0,loadOverlay=document.getElementById("load-container"),pageContainer=document.getElementById("page-container"),progressBar=document.getElementById("progress-bar"),imageCounter=document.createElement("button");function getCategories(){var e=new XMLHttpRequest;e.open("GET","https://api.nytimes.com/svc/books/v3/lists/names.json?api-key=957474c975634cc7a01a8a3ada453a94",!0),e.onload=function(){if(e.status>=200&&e.status<400){var a=JSON.parse(e.responseText);categoriesData=a,renderStaticContent()}},e.send()}function getOverview(){var e=new XMLHttpRequest;e.open("GET","http://api.nytimes.com/svc/books/v3/lists/overview?format=json&api-key=957474c975634cc7a01a8a3ada453a94",!0),e.onload=function(){if(e.status>=200&&e.status<400){var a=JSON.parse(e.responseText);overviewData=a,renderMainPage()}},e.send()}function getCategory(e){var a=e.replace(/-/g," "),t=new XMLHttpRequest;t.open("GET","http://api.nytimes.com/svc/books/v3/lists.json?list="+a+"&api-key=957474c975634cc7a01a8a3ada453a94",!0),t.onload=function(){if(t.status>=200&&t.status<400){var e=JSON.parse(t.responseText);categoryData=e,renderCategoryPage()}},t.send()}function getBook(e){var a=new XMLHttpRequest;a.open("GET","https://www.googleapis.com/books/v1/volumes?q=isbn:"+e,!0),a.onload=function(){if(a.status>=200&&a.status<400){var e=JSON.parse(a.responseText);bookData=e,renderBookPage()}},a.send()}function getWeeks(e){return e&&e>1?e+" weeks on the list":"New this week"}function getReview(e){return e?'<a class="review-link" href="'+e+'" target="_blank">Read Review</a>':""}function getBuyOptions(e){for(var a='<div class="buy"><div><a class="buy-button">Buy</a><div class="buy-options"><div class="arrow"><div class="innerarrow"></div></div>',t=0;t<e.length;t++)a+='<a href="'+e[t].url+'" target="_blank">'+e[t].name+"</a>";return a+="</div></div></div>"}function categoryChange(){var e=document.getElementById("category-change").value;window.location.hash=e}function parseHash(){progressBar.setAttribute("style","width: 10%;"),loadOverlay.className="loading",numImgsLoaded=0,totalImagesNeeded=0;var e=window.location.hash,a=e.replace("#","").split("_")[0];"book"===a?getBook(e.split("_")[1]):"category"===a?getCategory(e.split("_")[1]):getOverview()}function renderStaticContent(){for(var e=categoriesData.results,a='<div class="menu-bar"><div class="page-width"><select class="menu-toggle" id="category-change" onchange="categoryChange()"><option selected disabled>See all categories</option>',t=0;t<e.length;t++)a+='<option value="#category_'+e[t].list_name_encoded+'">'+e[t].list_name+"</option>";a+="</select>",a+='<div class="clear"></div></div></div>';var s='<div class="footer"><div class="page-width">'+categoriesData.copyright+"</div></div>";document.getElementById("header").innerHTML=a,document.getElementById("footer").innerHTML=s}function renderCategoryPage(){var e="",a=categoryData.results;e+='<div class="page-width"><div class="breadcrumb"><a href="#">All categories</a><span class="div">&gt;</span>'+a[0].list_name+"</a></div></div>";for(var t=0;t<a.length;t++){var s,o=a[t];s=0===o.rank_last_week||o.rank_last_week===o.rank?"":o.rank_last_week<o.rank?"&darr;":"&uarr;",e+='<div class="book-row"><div class="page-width"><a href="#book_'+o.isbns[0].isbn10+'"><div class="rank"><span>'+o.rank+'</span><span class="arrow-rank">'+s+'</span></div><img src=""><div class="book-content"><p class="book-weeks">'+getWeeks(o.weeks_on_list)+'</p><h3 class="book-title">'+o.book_details[0].title+'</h3><h3 class="author">'+o.book_details[0].author+"</h3><p>"+o.book_details[0].description+'</p></a><a class="buy" href="'+o.amazon_product_url+'">Buy</a>'+getReview(o.reviews[0].book_review_link)+'</div><div class="clear"></div></div></div>'}templateContent=e,totalImagesNeeded=0,numImgsLoaded=0,imageCounter.click()}function renderBookPage(){var e=bookData.items[0],a="";totalImagesNeeded++;var t=new Image;t.onload=function(){numImgsLoaded++,imageCounter.click()},t.src=e.volumeInfo.imageLinks.thumbnail,a+='<div class="book-page"><div class="page-width"><div class="breadcrumb"><a href="#">All categories</a><span class="div">&gt;</span><a href="#category_'+e.volumeInfo.title+'">'+e.volumeInfo.title+'</a><span class="div">&gt;</span><span class="cap-title">'+e.volumeInfo.title.toLowerCase()+'</span></div><div class="book-content"><p class="book-weeks">'+getWeeks(e.weeks_on_list)+'</p><h1 class="book-title">'+e.volumeInfo.title+'</h1><h3 class="author">'+e.volumeInfo.authors[0]+"</h3><p>"+e.volumeInfo.description+'</p></div><img src="'+e.volumeInfo.imageLinks.thumbnail+'"><div class="clear"></div></div></div>',templateContent=a}function renderMainPage(){for(var e=overviewData.results.lists,a="",t=0;t<e.length;t++){a+='<div class="page-width"><h2 class="category-title"><a href="#category_'+e[t].list_name_encoded+'">'+e[t].list_name+' <span class="small"> &#8250;</span></a></h2><div class="list">';for(var s=e[t].books,o=0;o<s.length;o++){totalImagesNeeded++;var n=new Image;n.onload=function(){numImgsLoaded++,imageCounter.click()},n.src=s[o].book_image,a+='<div class="book-column"><a href="#book_'+s[o].primary_isbn10+'"><div class="rank"><span>'+s[o].rank+'</span></div><img src="'+s[o].book_image+'"><div class="book-content"><p class="book-weeks">'+getWeeks(s[o].weeks_on_list)+'</p><h3 class="book-title">'+s[o].title+'</h3><h3 class="author">'+s[o].author+"</h3><p>"+s[o].description+"</p></a>"+getBuyOptions(s[o].buy_links)+getReview(s[o].book_review_link)+'</div><div class="clear"></div></div>'}a+='<div class="clear"></div></div></div>'}templateContent=a+="</div>"}imageCounter.addEventListener("click",function(e){var a=numImgsLoaded/totalImagesNeeded*100;progressBar.setAttribute("style","width: "+a+"%;"),numImgsLoaded===totalImagesNeeded&&(pageContainer.innerHTML=templateContent,loadOverlay.className="")},!1),window.onhashchange=function(){parseHash()},document.body.addEventListener("click",function(e){if("buy-button"===e.target.className)e.target.parentElement.className="buy-showing";else if(document.getElementsByClassName("buy-showing").length>0)for(var a=0;a<document.getElementsByClassName("buy-showing").length;a++)document.getElementsByClassName("buy-showing")[0].className=""}),getCategories(),parseHash();